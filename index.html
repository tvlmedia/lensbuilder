<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Meridional Raytracer (2D) — TVL Lens Builder</title>
  <link rel="stylesheet" href="./style.css">
</head>
<body>

<header class="topbar">
  <div class="brand">
    <div class="dot"></div>
    <div class="brandText">
      <div class="title">Meridional Raytracer (2D)</div>
      <div class="subtitle">OSLO-ish doorsnede • stop-aware • element builder • preview LUT • PL reference</div>
    </div>
  </div>

  <div class="toolbar">
    <button id="btnNew" class="btn">New / Clear</button>
    <button id="btnLoadOmit" class="btn">Load OMIT preset</button>
    <button id="btnLoadDemo" class="btn">Load demo</button>

    <div class="sep"></div>

    <button id="btnAdd" class="btn">+ Surface</button>
    <button id="btnAddElement" class="btn">+ Element</button>
    <button id="btnDuplicate" class="btn">Duplicate</button>
    <button id="btnMoveUp" class="btn">Up</button>
    <button id="btnMoveDown" class="btn">Down</button>
    <button id="btnRemove" class="btn danger">Remove</button>

    <div class="sep"></div>

    <button id="btnScaleToFocal" class="btn">Scale → FL</button>
    <button id="btnSetTStop" class="btn">Set T</button>
    <button id="btnAutoFocus" class="btn">Auto Focus</button>

    <div class="sep"></div>

    <button id="btnSave" class="btn">Save JSON</button>

    <label class="btn fileBtn">
      Load JSON
      <input id="fileLoad" type="file" accept="application/json">
    </label>
  </div>
</header>

<main class="app">
  <section class="left">
    <div class="panel">
      <div class="panelTitle">Setup</div>

      <div class="grid2">
        <div class="field">
          <label>Sensor preset</label>
          <select id="sensorPreset" class="cellSelect"></select>
        </div>

        <div class="field inline2">
          <div>
            <label>Sensor W (mm)</label>
            <input id="sensorW" class="cellInput" type="number" step="0.01" value="36.70">
          </div>
          <div>
            <label>Sensor H (mm)</label>
            <input id="sensorH" class="cellInput" type="number" step="0.01" value="25.54">
          </div>
        </div>

        <div class="field">
          <label>Field angle (deg)</label>
          <input id="fieldAngle" class="cellInput" type="number" step="0.05" value="0">
        </div>

        <div class="field">
          <label>Rays</label>
          <input id="rayCount" class="cellInput" type="number" step="1" value="31" min="3" max="101">
        </div>

        <div class="field">
          <label>Wave preset</label>
          <select id="wavePreset" class="cellSelect">
            <option value="d">d (587.6nm)</option>
            <option value="g">g (blue)</option>
            <option value="c">c (red)</option>
          </select>
        </div>

        <div class="field">
          <label>Lens focus (mm shift)</label>
          <input id="lensFocus" class="cellInput" type="number" step="0.05" value="0">
        </div>

        <div class="field">
          <label>Render scale</label>
          <input id="renderScale" class="cellInput" type="number" step="0.05" value="1.25">
        </div>

        <div class="field">
          <label>Focus mode</label>
          <select id="focusMode" class="cellSelect">
            <option value="lens">Lens</option>
            <option value="cam">Cam (disabled)</option>
          </select>
        </div>

        <div class="field">
          <label>Sensor offset (disabled in build)</label>
          <input id="sensorOffset" class="cellInput" type="number" step="0.01" value="0">
        </div>
      </div>

      <div class="badges">
        <div id="badgeEfl" class="badge">Focal Length: —</div>
        <div id="badgeBfl" class="badge">BFL: —</div>
        <div id="badgeT" class="badge">T≈ —</div>
        <div id="badgeVig" class="badge">Vignette: —</div>
        <div id="badgeFov" class="badge">FOV: —</div>
        <div id="badgeCov" class="badge">COV: —</div>
      </div>

      <div class="hidden">
        <span id="badgeEflTop"></span>
        <span id="badgeBflTop"></span>
        <span id="badgeTTop"></span>
        <span id="badgeFovTop"></span>
        <span id="badgeCovTop"></span>
      </div>

      <div class="metaRow">
        <div id="metaInfo" class="meta">sensor —</div>
        <div id="statusText" class="meta">status —</div>
      </div>
      <div id="footerWarn" class="warn"></div>
    </div>

    <div class="panel tablePanel">
      <div class="panelTitle">Surfaces</div>

      <div class="tableWrap">
        <table class="t">
          <thead>
            <tr>
              <th style="width:34px">#</th>
              <th style="width:72px">type</th>
              <th style="width:92px">R</th>
              <th style="width:92px">t</th>
              <th style="width:92px">ap</th>
              <th style="width:110px">glass</th>
              <th style="width:58px">STOP</th>
            </tr>
          </thead>
          <tbody id="surfTbody"></tbody>
        </table>
      </div>
    </div>
  </section>

  <section class="right">
    <div class="split">
      <div id="raysPane" class="pane">
        <div class="paneTop">
          <div class="paneTitle">Rays / Cross-section</div>
          <div class="paneActions">
            <button id="btnRaysFS" class="btn small">Fullscreen</button>
          </div>
        </div>
        <div class="canvasWrap">
          <canvas id="canvas"></canvas>
        </div>
      </div>

      <div id="previewPane" class="pane">
        <div class="paneTop">
          <div class="paneTitle">Preview (chart)</div>
          <div class="paneActions">
            <button id="btnRenderPreview" class="btn small">Render</button>
            <button id="btnPreviewFS" class="btn small">Fullscreen</button>
          </div>
        </div>

        <div class="previewControls">
          <label class="btn fileBtn small">
            Upload chart
            <input id="prevImg" type="file" accept="image/*">
          </label>

          <div class="field smallField">
            <label>ObjDist (mm)</label>
            <input id="prevObjDist" class="cellInput" type="number" step="10" value="2000">
          </div>
          <div class="field smallField">
            <label>ObjH (mm)</label>
            <input id="prevObjH" class="cellInput" type="number" step="1" value="1900">
          </div>
          <div class="field smallField">
            <label>Base res (H)</label>
            <input id="prevRes" class="cellInput" type="number" step="64" value="1920" min="256" max="4096">
          </div>
        </div>

        <div class="canvasWrap">
          <canvas id="previewCanvas"></canvas>
        </div>
      </div>
    </div>
  </section>
</main>

<!-- ELEMENT MODAL -->
<div id="elementModal" class="modal hidden">
  <div class="modalCard">
    <div class="modalHead">
      <div class="modalTitle">Add Element</div>
      <button id="elClose" class="btn small">Close</button>
    </div>

    <div class="modalGrid">
      <div class="field">
        <label>Type</label>
        <select id="elType" class="cellSelect">
          <option value="singlet">Singlet</option>
          <option value="achromat">Achromat (air-spaced)</option>
          <option value="achromat_cemented">Achromat (cemented)</option>
          <option value="stop">STOP</option>
          <option value="airgap">AIR gap</option>
        </select>
      </div>

      <div class="field">
        <label>Mode</label>
        <select id="elMode" class="cellSelect">
          <option value="auto">Auto</option>
          <option value="custom">Custom (n/a)</option>
        </select>
      </div>

      <div class="field">
        <label>F (mm)</label>
        <input id="elF" class="cellInput" type="number" step="0.1" value="50">
      </div>

      <div class="field">
        <label>ap (semi-diam, mm)</label>
        <input id="elAp" class="cellInput" type="number" step="0.1" value="18">
      </div>

      <div class="field">
        <label>CT (mm)</label>
        <input id="elCt" class="cellInput" type="number" step="0.01" value="4">
      </div>

      <div class="field">
        <label>Gap (mm)</label>
        <input id="elGap" class="cellInput" type="number" step="0.01" value="0.20">
      </div>

      <div class="field">
        <label>Rear air (mm)</label>
        <input id="elAir" class="cellInput" type="number" step="0.01" value="4">
      </div>

      <div class="field">
        <label>Form</label>
        <select id="elForm" class="cellSelect">
          <option value="symmetric">Symmetric</option>
          <option value="weakmeniscus">Weak meniscus</option>
          <option value="plano">Plano</option>
        </select>
      </div>

      <div class="field">
        <label>Glass 1</label>
        <select id="elGlass1" class="cellSelect"></select>
      </div>

      <div class="field">
        <label>Glass 2</label>
        <select id="elGlass2" class="cellSelect"></select>
      </div>

      <div class="field span2">
        <label>Note</label>
        <textarea id="elGlassNote" class="cellArea" rows="4" readonly></textarea>
      </div>
    </div>

    <div class="modalFoot">
      <button id="elAdd" class="btn">Insert</button>
    </div>
  </div>
</div>

<!-- NEW LENS MODAL -->
<div id="newLensModal" class="modal hidden">
  <div class="modalCard">
    <div class="modalHead">
      <div class="modalTitle">New Lens</div>
      <button id="nlClose" class="btn small">Close</button>
    </div>

    <div class="modalGrid">
      <div class="field">
        <label>Template</label>
        <select id="nlTemplate" class="cellSelect">
          <option value="blank">Blank</option>
          <option value="doubleGauss">Double-Gauss-ish (OMIT)</option>
          <option value="tessar">Tessar-ish</option>
          <option value="omit50v1">OMIT 50 v1</option>
        </select>
      </div>

      <div class="field">
        <label>Name</label>
        <input id="nlName" class="cellInput" type="text" value="New lens">
      </div>

      <div class="field">
        <label>Target focal (mm)</label>
        <input id="nlFocal" class="cellInput" type="number" step="0.1" value="50">
      </div>

      <div class="field">
        <label>Target T</label>
        <input id="nlT" class="cellInput" type="number" step="0.05" value="2.8">
      </div>

      <div class="field span2">
        <label>STOP position</label>
        <select id="nlStopPos" class="cellSelect">
          <option value="keep">Keep template</option>
          <option value="middle">Force middle</option>
        </select>
      </div>
    </div>

    <div class="modalFoot">
      <button id="nlCreate" class="btn">Create</button>
    </div>
  </div>
</div>

<div id="toastHost" class="toastHost"></div>

<script src="./script.js"></script>
</body>
</html>
