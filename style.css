/* TVL — Meridional Raytracer (2D) — Full CSS Rebuild (SINGLE SOURCE OF TRUTH)
   - body = flex column, layout fills remaining height
   - LEFT: header + status fixed; controls + table scroll together (leftScroll)
   - RIGHT: canvasFrame flexes properly; no vh calc hacks; no duplicate "hard fix"
*/

:root{
  --bg:#0b0f16;
  --panel:#0f1624;
  --panel2:#0c1220;

  --stroke:rgba(255,255,255,.10);
  --stroke2:rgba(255,255,255,.18);

  --text:rgba(255,255,255,.92);
  --muted:rgba(255,255,255,.62);
  --muted2:rgba(255,255,255,.44);

  --accent:#2a6ef2;
  --ok:#42d18f;
  --danger:#d95b5b;

  --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
  --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;

  --r:16px;
  --r2:22px;

  /* canvas */
  --canvasBg:#f7f9fe;
  --canvasGrid:rgba(20,25,35,.08);
  --canvasBorder:rgba(0,0,0,.10);
}

/* -------------------- base -------------------- */
*{ box-sizing:border-box; }
html,body{ height:100%; }

body{
  margin:0;
  font-family:var(--sans);
  color:var(--text);
  background:
    radial-gradient(1200px 600px at 20% -10%, rgba(42,110,242,.22), transparent 55%),
    radial-gradient(900px 500px at 70% 0%, rgba(66,209,143,.14), transparent 55%),
    var(--bg);

  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;

  display:flex;
  flex-direction:column;
  min-height:100%;
  overflow:hidden; /* page itself never scrolls (desktop) */
}

button, input, select, textarea{
  font-family:var(--sans);
  font-size:14px;
}

a{ color:inherit; }

/* -------------------- topbar -------------------- */
.topbar{
  position:sticky;
  top:0;
  z-index:50;

  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:14px;
  padding:12px 14px;

  background: linear-gradient(180deg, rgba(10,14,22,.92), rgba(10,14,22,.76));
  border-bottom:1px solid var(--stroke);
  backdrop-filter: blur(10px);

  flex:0 0 auto;
}

.brand{
  display:flex;
  align-items:center;
  gap:10px;
  min-width:320px;
}

.dot{
  width:10px;
  height:10px;
  border-radius:50%;
  background: var(--accent);
  box-shadow: 0 0 0 6px rgba(42,110,242,.12);
}

.brandText .title{
  font-weight:900;
  letter-spacing:.2px;
  line-height:1.05;
}

.brandText .subtitle{
  margin-top:2px;
  font-size:12px;
  color:var(--muted);
}

/* -------------------- toolbar + buttons -------------------- */
.toolbar{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  align-items:center;
  justify-content:flex-end;
}

.sep{
  width:1px;
  height:28px;
  background:var(--stroke);
  margin:0 6px;
}

.btn{
  border:1px solid var(--stroke);
  background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
  color:var(--text);
  padding:8px 10px;
  border-radius:12px;
  font-size:12px;
  cursor:pointer;
  user-select:none;
  transition: transform .08s ease, border-color .12s ease, background .12s ease, filter .12s ease;
}

.btn:hover{
  border-color:var(--stroke2);
  transform: translateY(-1px);
  filter: brightness(1.03);
}

.btn:active{ transform: translateY(0px); }

.btnPrimary{
  border-color: rgba(42,110,242,.55);
  background: linear-gradient(180deg, rgba(42,110,242,.36), rgba(42,110,242,.18));
}

.btnDanger{
  border-color: rgba(217,91,91,.55);
  background: linear-gradient(180deg, rgba(217,91,91,.28), rgba(217,91,91,.14));
}

.fileBtn{ position:relative; overflow:hidden; }
.fileBtn input{ position:absolute; inset:0; opacity:0; cursor:pointer; }

/* -------------------- layout / panels -------------------- */
.layout{
  flex:1 1 auto;
  min-height:0;

  display:grid;
  grid-template-columns: 520px 1fr;
  gap:14px;
  padding:14px;

  overflow:hidden;
}

.panel{
  border:1px solid var(--stroke);
  background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
  border-radius: var(--r2);
  overflow:hidden;
  box-shadow: 0 16px 50px rgba(0,0,0,.35);

  min-height:0;
  display:flex;
  flex-direction:column;
}

.left{ min-width:420px; }
.right{ overflow:hidden; }

/* -------------------- headers -------------------- */
.panelHeader{
  padding:14px 14px 10px;
  border-bottom:1px solid var(--stroke);
  background: linear-gradient(180deg, rgba(255,255,255,.04), transparent);
  flex:0 0 auto;
}

.h1{ font-weight:900; letter-spacing:.2px; }

.hint{
  color:var(--muted);
  font-size:12px;
  margin-top:6px;
  line-height:1.25;
}

/* -------------------- LEFT scroll region -------------------- */
.leftScroll{
  flex:1 1 auto;
  min-height:0;
  overflow:auto;

  -webkit-overflow-scrolling: touch;
  overscroll-behavior: contain;
}

/* -------------------- controls -------------------- */
.controls{
  padding:12px 14px;
  border-bottom:1px solid var(--stroke);
  background: rgba(0,0,0,.12);
}

.controlGrid{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap:10px;
}

.ctrl label{
  display:block;
  font-size:12px;
  color:var(--muted);
  margin-bottom:6px;
}

.ctrl.two{ grid-column: span 2; }

.ctrl input, .ctrl select, .ctrl textarea{
  width:100%;
  border-radius:12px;
  border:1px solid var(--stroke);
  background: rgba(0,0,0,.22);
  color:var(--text);
  padding:8px 10px;
  outline:none;
}

.ctrl input[type="range"]{
  padding:0;
  height:36px;
}

.ctrl input:focus, .ctrl select:focus, .ctrl textarea:focus{
  border-color: rgba(42,110,242,.55);
  box-shadow: 0 0 0 4px rgba(42,110,242,.14);
}

.ctrl textarea{ min-height:90px; resize:vertical; }

/* -------------------- table -------------------- */
.tableWrap{
  padding:10px 10px 14px;
}

.tbl{
  width:100%;
  border-collapse:separate;
  border-spacing:0 8px;
}

.tbl thead th{
  font-size:11px;
  color:var(--muted);
  text-align:left;
  padding:0 10px;
  font-weight:700;
}

.tbl tbody tr{
  background: rgba(0,0,0,.20);
  border:1px solid var(--stroke);
}

.tbl tbody tr td{ padding:6px 8px; }

.tbl tbody tr td:first-child{
  border-top-left-radius:14px;
  border-bottom-left-radius:14px;
}

.tbl tbody tr td:last-child{
  border-top-right-radius:14px;
  border-bottom-right-radius:14px;
}

.tbl tbody tr.selected{
  outline: 2px solid rgba(42,110,242,.55);
  box-shadow: 0 0 0 6px rgba(42,110,242,.12);
}

.cellInput, .cellSelect{
  width:100%;
  border-radius:12px;
  border:1px solid var(--stroke);
  background: rgba(255,255,255,.03);
  color:var(--text);
  padding:7px 8px;
  font-family:var(--mono);
  font-size:12px;
  outline:none;
}

.cellInput:focus, .cellSelect:focus{
  border-color: rgba(42,110,242,.55);
  box-shadow: 0 0 0 3px rgba(42,110,242,.12);
}

.cellChk{ text-align:center; }
.cellChk input{ width:18px; height:18px; accent-color: var(--accent); }

/* -------------------- status / badges -------------------- */
.status{
  padding:12px 14px;
  border-top:1px solid var(--stroke);
  background: rgba(0,0,0,.18);
  flex:0 0 auto;
}

.statusLine{
  font-size:12px;
  color:var(--muted);
  margin-bottom:10px;
}

.badges{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
}

.badge{
  padding:7px 10px;
  border-radius:999px;
  border:1px solid var(--stroke);
  background: rgba(0,0,0,.22);
  font-family:var(--mono);
  font-size:12px;
}

.badgeWide{ flex:1; min-width:240px; }

.footerRow{
  margin-top:10px;
  display:flex;
  gap:10px;
  align-items:center;
  justify-content:space-between;
}

.meta{
  color:var(--muted2);
  font-size:12px;
  font-family:var(--mono);
}

.warn{
  color:rgba(217,91,91,.95);
  font-size:12px;
  font-family:var(--mono);
}

/* -------------------- canvas header -------------------- */
.canvasHeader{
  display:flex;
  align-items:flex-end;
  justify-content:space-between;
  gap:14px;
  padding:14px;
  border-bottom:1px solid var(--stroke);
  background: linear-gradient(180deg, rgba(255,255,255,.04), transparent);
  flex:0 0 auto;
}

.canvasTitle .hint{ margin:0; }

.topBadges{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  justify-content:flex-end;
}

.pill{
  padding:7px 10px;
  border-radius:999px;
  border:1px solid var(--stroke);
  background: rgba(0,0,0,.20);
  font-family:var(--mono);
  font-size:12px;
  color:var(--text);
}

/* -------------------- canvas frame + split panes -------------------- */
.canvasFrame{
  flex:1 1 auto;
  min-height:0;

  position:relative;
  margin:14px;
  border-radius: var(--r2);
  border:1px solid var(--canvasBorder);
  overflow:hidden;

  background:
    radial-gradient(900px 520px at 40% 30%, rgba(42,110,242,.06), transparent 60%),
    radial-gradient(700px 520px at 70% 60%, rgba(66,209,143,.05), transparent 62%),
    var(--canvasBg);
}

.canvasFrame::before{
  content:"";
  position:absolute;
  inset:0;
  background-image:
    linear-gradient(to right, var(--canvasGrid) 1px, transparent 1px),
    linear-gradient(to bottom, var(--canvasGrid) 1px, transparent 1px);
  background-size: 40px 40px;
  opacity:.55;
  pointer-events:none;
}

.canvasSplit{
  position:relative;
  height:100%;
  width:100%;
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap:12px;
  padding:12px;
}

.pane{
  position:relative;
  border-radius: 18px;
  border:1px solid rgba(0,0,0,.10);
  overflow:hidden;
  background: rgba(255,255,255,.45);
}

.paneTag{
  position:absolute;
  left:10px;
  top:10px;
  z-index:5;
  padding:6px 10px;
  border-radius:999px;
  border:1px solid rgba(0,0,0,.10);
  background: rgba(255,255,255,.72);
  color: rgba(0,0,0,.65);
  font-family: var(--mono);
  font-size:12px;
}

#canvas, #previewCanvas{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  display:block;
}

/* preview fullscreen button */
.fsBtn{
  position:absolute;
  right:10px;
  top:10px;
  z-index:6;
  border:1px solid rgba(0,0,0,.12);
  background: rgba(255,255,255,.86);
  color: rgba(0,0,0,.72);
  padding:7px 10px;
  border-radius: 12px;
  font-size:12px;
  cursor:pointer;
  font-family: var(--mono);
  transition: transform .08s ease, filter .12s ease;
}

.fsBtn:hover{ filter: brightness(1.03); transform: translateY(-1px); }
.fsBtn:active{ transform: translateY(0px); }

/* overlay help */
.canvasOverlay{
  position:absolute;
  left:12px;
  right:12px;
  bottom:10px;
  display:flex;
  justify-content:flex-start;
  pointer-events:none;
}

.overlayHelp{
  padding:8px 10px;
  border-radius:14px;
  border:1px solid rgba(0,0,0,.10);
  background: rgba(255,255,255,.78);
  color: rgba(0,0,0,.70);
  font-size:12px;
  font-family:var(--mono);
}

/* -------------------- modals -------------------- */
.modal{
  position:fixed;
  inset:0;
  background: rgba(0,0,0,.55);
  backdrop-filter: blur(8px);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:100;
  padding:20px;
}

.hidden{ display:none !important; }

.modalCard{
  width:min(900px, 96vw);
  max-height:min(760px, 88vh);
  border-radius: var(--r2);
  border:1px solid var(--stroke);
  background: linear-gradient(180deg, rgba(15,22,36,.98), rgba(12,18,32,.98));
  box-shadow: 0 26px 90px rgba(0,0,0,.55);
  overflow:hidden;
  display:flex;
  flex-direction:column;
}

.modalTop{
  display:flex;
  justify-content:space-between;
  align-items:flex-start;
  gap:14px;
  padding:14px 16px;
  border-bottom:1px solid var(--stroke);
}

.modalTitle{ font-weight:900; letter-spacing:.2px; }
.modalSub{ color:var(--muted); font-size:12px; margin-top:4px; }

.modalX{
  width:36px;
  height:36px;
  border-radius:12px;
  border:1px solid var(--stroke);
  background: rgba(255,255,255,.04);
  color:var(--text);
  cursor:pointer;
}

.modalScroll{
  padding:14px 16px;
  overflow:auto;
}

.modalGrid{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap:12px;
}

.field label{
  display:block;
  font-size:12px;
  color:var(--muted);
  margin-bottom:6px;
}

.fieldFull{ grid-column: 1 / -1; }

.modalGrid .cellInput,
.modalGrid .cellSelect,
.modalGrid textarea{
  width:100%;
  border-radius:12px;
  border:1px solid var(--stroke);
  background: rgba(0,0,0,.22);
  color:var(--text);
  padding:9px 10px;
  outline:none;
  font-family:var(--mono);
  font-size:12px;
}

.modalGrid textarea{
  min-height:96px;
  resize:vertical;
}

.modalGrid .cellInput:focus,
.modalGrid .cellSelect:focus,
.modalGrid textarea:focus{
  border-color: rgba(42,110,242,.55);
  box-shadow: 0 0 0 4px rgba(42,110,242,.14);
}

.modalBottom{
  padding:12px 16px;
  border-top:1px solid var(--stroke);
  display:flex;
  justify-content:flex-end;
  background: rgba(0,0,0,.18);
}

.btnPrimary{
  border:1px solid rgba(42,110,242,.55);
  background: linear-gradient(180deg, rgba(42,110,242,.36), rgba(42,110,242,.18));
  color:var(--text);
  padding:10px 14px;
  border-radius:12px;
  cursor:pointer;
  font-weight:800;
}

/* custom element table (inside modal) */
.customTable{
  width:100%;
  border-collapse:separate;
  border-spacing:0 8px;
}

.customTable thead th{
  font-size:11px;
  color:var(--muted);
  text-align:left;
  padding:0 10px;
  font-weight:700;
}

.customTable tbody tr{
  background: rgba(0,0,0,.20);
  border:1px solid var(--stroke);
}

.customTable tbody tr td{ padding:6px 8px; }

.customBox{
  border-top:1px solid var(--stroke);
  margin-top:14px;
  padding-top:14px;
}

/* glass note block */
.glassNote{
  border:1px solid var(--stroke);
  background: rgba(0,0,0,.18);
  border-radius:14px;
  padding:10px 12px;
  color:var(--muted);
  font-family:var(--mono);
  font-size:12px;
  line-height:1.35;
}

/* -------------------- responsive -------------------- */
@media (max-width: 1100px){
  .layout{ grid-template-columns: 480px 1fr; }
}

@media (max-width: 980px){
  body{ overflow:auto; } /* allow page scroll */
  .layout{
    grid-template-columns: 1fr;
    overflow:visible;
  }
  .left{ min-width:0; }
  .canvasSplit{ grid-template-columns: 1fr; }
}

@media (max-width: 720px){
  .brand{ min-width: 0; }
  .modalGrid{ grid-template-columns: 1fr; }
  .controlGrid{ grid-template-columns: 1fr; }
  .ctrl.two{ grid-column: span 1; }
}
